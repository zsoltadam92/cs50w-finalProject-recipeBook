<!-- shopping_list_view.html -->

{% extends "recepies/layout.html" %}
{% block content %}
<h2>Bevásárlólista</h2>

<ul id="shoppingList">
  {% for item in shopping_list.shoppinglistitem_set.all %}
  <li id="item-{{item.id}}">
      <input type="checkbox"  onchange="toggleStrikethrough(this);">
      <span>
        {{ item.ingredient.quantity }} {{ item.ingredient.unit }} {{ item.ingredient.name }} 
      </span>

      <button type="button" class="btn btn-danger" onclick="deleteListItem({{ item.id }})">Delete</button>
  </li>
  {% empty %}
  <p>Nincsenek hozzávalók a kosárban.</p>
  {% endfor %}
</ul>

<script>

  function toggleClass(element, className, condition) {
    condition ? element.classList.add(className) : element.classList.remove(className);
};

function toggleStrikethrough(checkbox) {
    const textElement = checkbox.nextElementSibling;
    toggleClass(textElement, 'strikethrough', checkbox.checked);
}
  
  
  function deleteListItem(itemId) {
    fetch(`/delete-list-item/${itemId}/`, {
      method: 'POST',
      headers: {
        'X-CSRFToken': getCookie('csrftoken'),
        'Content-Type': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        document.getElementById(`item-${itemId}`).remove(); 
        
        updateEmptyMassage();
        } else {
          alert('Hiba történt a törlés során.');
        }
      })
  .catch(error => console.error('Hiba:', error));
}

function updateEmptyMassage() {
  const shoppingList = document.getElementById("shoppingList")
  const items = shoppingList.querySelectorAll("li")

  if ( items.length === 0) {
    shoppingList.innerHTML = '<p>Nincsenek hozzávalók a kosárban.</p>';

  }
}


function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
          }
      }
  }
  return cookieValue;
}

  </script>


  {% endblock %}